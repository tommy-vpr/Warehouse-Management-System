generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model WorkTask {
  id              String         @id @default(cuid())
  taskNumber      String         @unique
  type            WorkTaskType
  status          WorkTaskStatus @default(PENDING)
  assignedTo      String?
  assignedAt      DateTime?
  startedAt       DateTime?
  completedAt     DateTime?
  orderIds        String[]
  totalOrders     Int
  completedOrders Int            @default(0)
  totalItems      Int
  completedItems  Int            @default(0)
  priority        Int            @default(0)
  notes           String?
  parentTaskId    String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  events          TaskEvent[]
  taskItems       TaskItem[]
  assignedUser    User?          @relation(fields: [assignedTo], references: [id])
  parentTask      WorkTask?      @relation("TaskContinuation", fields: [parentTaskId], references: [id])
  continuations   WorkTask[]     @relation("TaskContinuation")

  @@index([type, status])
  @@index([assignedTo])
  @@map("work_tasks")
}

model TaskItem {
  id                String             @id @default(cuid())
  taskId            String
  orderId           String
  productVariantId  String?
  locationId        String?
  quantityRequired  Int
  quantityCompleted Int                @default(0)
  status            WorkTaskItemStatus @default(PENDING)
  sequence          Int
  completedBy       String?
  completedAt       DateTime?
  notes             String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  completedByUser   User?              @relation(fields: [completedBy], references: [id])
  location          Location?          @relation(fields: [locationId], references: [id])
  order             Order              @relation(fields: [orderId], references: [id])
  productVariant    ProductVariant?    @relation(fields: [productVariantId], references: [id])
  task              WorkTask           @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@index([orderId])
  @@map("task_items")
}

model TaskEvent {
  id        String            @id @default(cuid())
  taskId    String
  eventType WorkTaskEventType
  userId    String
  data      Json?
  notes     String?
  createdAt DateTime          @default(now())
  task      WorkTask          @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user      User              @relation(fields: [userId], references: [id])

  @@index([taskId])
  @@map("task_events")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model User {
  id                        String                 @id @default(cuid())
  name                      String?
  email                     String                 @unique
  emailVerified             DateTime?
  image                     String?
  role                      UserRole               @default(STAFF)
  createdAt                 DateTime               @default(now())
  updatedAt                 DateTime               @updatedAt
  currentChallenge          String?
  password                  String?
  tokenExpires              DateTime?
  verificationToken         String?                @unique
  credentials               UserCredential[]
  accounts                  Account[]
  createdBackOrders         BackOrder[]            @relation("BackOrderCreatedBy")
  fulfilledBackOrders       BackOrder[]            @relation("BackOrderFulfilledBy")
  countEvents               CycleCountEvent[]
  assignedCountTasks        CycleCountTask[]
  inventoryTransactions     InventoryTransaction[]
  notifications             Notification[]
  statusChanges             OrderStatusHistory[]
  packingOrders             Order[]                @relation("PackingOrders")
  pickingOrders             Order[]                @relation("PickingOrders")
  shippingOrders            Order[]                @relation("ShippingOrders")
  pickEventsAsFromUser      PickEvent[]            @relation("PickEventFromUser")
  pickEventsAsToUser        PickEvent[]            @relation("PickEventToUser")
  pickEvents                PickEvent[]            @relation("PickEventUser")
  pickedItems               PickListItem[]
  assignedPickLists         PickList[]
  poBarcodeEvents           POBarcodeEvent[]
  printedBarcodes           POBarcode[]            @relation("UserPrintedBarcodes")
  receivingEvents           ReceivingEvent[]
  receivingSessionsApproved ReceivingSession[]     @relation("ApprovedBy")
  receivingSessionsAssigned ReceivingSession[]     @relation("AssignedReceivingApprover")
  receivingSessionsCounted  ReceivingSession[]     @relation("CountedBy")
  returnEvents              ReturnEvent[]
  returnInspections         ReturnInspection[]     @relation("ReturnInspector")
  returnOrdersApproved      ReturnOrder[]          @relation("ReturnApprovedBy")
  returnOrdersInspected     ReturnOrder[]          @relation("ReturnInspectedBy")
  returnOrdersReceived      ReturnOrder[]          @relation("ReturnReceivedBy")
  sessions                  Session[]
  createdShippingPackages   ShippingPackage[]      @relation("ShippingPackageCreatedBy")
  shippedPackages           ShippingPackage[]      @relation("ShippingPackageShippedBy")
  taskEvents                TaskEvent[]
  completedTaskItems        TaskItem[]
  assignedTasks             WorkTask[]

  @@map("users")
}

model UserCredential {
  id           String   @id @default(cuid())
  userId       String
  credentialId String   @unique
  publicKey    String
  counter      Int
  transports   String?
  deviceType   String?
  backedUp     Boolean?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Product {
  id               String           @id @default(cuid())
  sku              String           @unique
  name             String
  description      String?
  shopifyProductId String?          @unique
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  brand            String?
  category         String?
  flavor           String?
  productLine      String?
  variants         ProductVariant[]

  @@index([brand])
  @@index([category])
  @@index([productLine])
  @@index([flavor])
  @@map("products")
}

model ProductVariant {
  id                    String                 @id @default(cuid())
  productId             String
  sku                   String                 @unique
  upc                   String?                @unique
  name                  String
  costPrice             Decimal?               @db.Decimal(10, 2)
  sellingPrice          Decimal?               @db.Decimal(10, 2)
  weight                Decimal?               @db.Decimal(8, 2)
  dimensions            Json?
  shopifyVariantId      String?                @unique
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  category              String?
  supplier              String?
  barcode               String?
  flavor                String?
  hasIce                Boolean                @default(false)
  hasSalt               Boolean                @default(false)
  isNicotineFree        Boolean                @default(false)
  masterCaseDimensions  Json?
  masterCaseQty         Int?
  masterCaseWeight      Decimal?               @db.Decimal(8, 2)
  productLine           String?
  strength              String?
  volume                String?
  backOrders            BackOrder[]
  countTasks            CycleCountTask[]
  inventory             Inventory[]
  reservations          InventoryReservation[]
  inventoryTransactions InventoryTransaction[]
  invoiceItems          InvoiceItem[]
  orderItems            OrderItem[]
  pickListItems         PickListItem[]
  product               Product                @relation(fields: [productId], references: [id])
  purchaseOrderItems    PurchaseOrderItem[]
  returnItems           ReturnItem[]
  taskItems             TaskItem[]

  @@index([volume])
  @@index([strength])
  @@index([hasIce])
  @@index([hasSalt])
  @@index([flavor])
  @@index([productLine])
  @@index([upc])
  @@index([barcode])
  @@map("product_variants")
}

model Location {
  id                    String                 @id @default(cuid())
  name                  String                 @unique
  type                  LocationType           @default(GENERAL)
  zone                  String?
  aisle                 String?
  shelf                 String?
  bin                   String?
  isPickable            Boolean                @default(true)
  isReceivable          Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  barcode               String?                @unique
  bay                   Int?
  space                 Int?
  tier                  String?
  warehouseNumber       Int?
  countTasks            CycleCountTask[]
  inventory             Inventory[]
  reservations          InventoryReservation[]
  inventoryTransactions InventoryTransaction[]
  pickListItems         PickListItem[]
  returnInspections     ReturnInspection[]
  taskItems             TaskItem[]

  @@index([warehouseNumber, aisle, bay, tier, space, bin])
  @@index([warehouseNumber, aisle])
  @@index([barcode])
  @@index([type])
  @@map("locations")
}

model Inventory {
  id               String         @id @default(cuid())
  productVariantId String
  locationId       String
  quantityOnHand   Int            @default(0)
  quantityReserved Int            @default(0)
  reorderPoint     Int?
  maxQuantity      Int?
  lastCounted      DateTime?
  updatedAt        DateTime       @updatedAt
  casesOnHand      Int?           @default(0)
  casesReserved    Int?           @default(0)
  location         Location       @relation(fields: [locationId], references: [id])
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])

  @@unique([productVariantId, locationId])
  @@map("inventory")
}

model Order {
  id                    String                 @id @default(cuid())
  shopifyOrderId        String?                @unique
  orderNumber           String                 @unique
  customerName          String
  customerEmail         String?
  status                OrderStatus            @default(PENDING)
  totalAmount           Decimal                @db.Decimal(10, 2)
  shippingAddress       Json
  billingAddress        Json?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  shippedAt             DateTime?
  shippingStatus        String?
  trackingNumber        String?
  trackingUrl           String?
  notes                 String?
  shippingCarrier       String?
  shippingCost          String?
  shippingService       String?
  labelUrl              String?
  hasBackOrders         Boolean                @default(false)
  shopifyFulfillmentIds String?
  shopifyLineItems      Json?
  currentStage          OrderStage?            @default(PICKING)
  packingAssignedAt     DateTime?
  packingAssignedTo     String?
  pickingAssignedAt     DateTime?
  pickingAssignedTo     String?
  shippingAssignedAt    DateTime?
  shippingAssignedTo    String?
  backOrders            BackOrder[]
  reservations          InventoryReservation[]
  invoices              Invoice[]
  images                OrderImage[]
  items                 OrderItem[]
  statusHistory         OrderStatusHistory[]
  packingUser           User?                  @relation("PackingOrders", fields: [packingAssignedTo], references: [id])
  pickingUser           User?                  @relation("PickingOrders", fields: [pickingAssignedTo], references: [id])
  shippingUser          User?                  @relation("ShippingOrders", fields: [shippingAssignedTo], references: [id])
  pickListItems         PickListItem[]
  returns               ReturnOrder[]
  packages              ShippingPackage[]
  shopifySyncs          ShopifySync[]
  taskItems             TaskItem[]

  @@map("orders")
}

model OrderImage {
  id        String   @id @default(cuid())
  orderId   String
  url       String
  reference String?
  createdAt DateTime @default(now())
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@map("order_images")
}

model InventoryReservation {
  id               String            @id @default(cuid())
  orderId          String
  productVariantId String
  locationId       String
  quantity         Int
  status           ReservationStatus @default(ACTIVE)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  location         Location          @relation(fields: [locationId], references: [id])
  order            Order             @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productVariant   ProductVariant    @relation(fields: [productVariantId], references: [id])

  @@unique([orderId, productVariantId, locationId])
  @@index([orderId])
  @@index([productVariantId, locationId])
  @@map("inventory_reservations")
}

model OrderStatusHistory {
  id             String      @id @default(cuid())
  orderId        String
  previousStatus OrderStatus
  newStatus      OrderStatus
  changedBy      String
  changedAt      DateTime    @default(now())
  notes          String?
  changedByUser  User        @relation(fields: [changedBy], references: [id])
  order          Order       @relation(fields: [orderId], references: [id])

  @@map("order_status_history")
}

model OrderItem {
  id                                String         @id @default(cuid())
  orderId                           String
  productVariantId                  String
  quantity                          Int
  unitPrice                         Decimal        @db.Decimal(10, 2)
  totalPrice                        Decimal        @db.Decimal(10, 2)
  shopifyFulfillmentOrderLineItemId String?
  shopifyLineItemId                 String?
  quantityPacked                    Int?           @default(0)
  quantityPicked                    Int?           @default(0)
  order                             Order          @relation(fields: [orderId], references: [id])
  productVariant                    ProductVariant @relation(fields: [productVariantId], references: [id])
  pickListItems                     PickListItem[]

  @@map("order_items")
}

model ShopifySync {
  id          String    @id @default(cuid())
  orderId     String
  syncType    String
  status      String
  attempts    Int       @default(0)
  data        Json
  error       String?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  order       Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([status, syncType])
  @@map("shopify_syncs")
}

model InventoryTransaction {
  id               String          @id @default(cuid())
  productVariantId String
  locationId       String?
  transactionType  TransactionType
  quantityChange   Int
  referenceId      String?
  referenceType    String?
  userId           String?
  notes            String?
  createdAt        DateTime        @default(now())
  metadata         Json?
  sourceLocation   String?
  location         Location?       @relation(fields: [locationId], references: [id])
  productVariant   ProductVariant  @relation(fields: [productVariantId], references: [id])
  user             User?           @relation(fields: [userId], references: [id])

  @@index([productVariantId])
  @@index([locationId])
  @@index([userId])
  @@index([referenceType])
  @@map("inventory_transactions")
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String
  title     String
  message   String
  link      String?
  read      Boolean  @default(false)
  metadata  Json?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, read])
  @@map("notifications")
}

model PickList {
  id               String         @id @default(cuid())
  batchNumber      String         @unique
  status           PickStatus     @default(PENDING)
  assignedTo       String?
  priority         Int            @default(0)
  totalItems       Int
  pickedItems      Int            @default(0)
  startTime        DateTime?
  endTime          DateTime?
  notes            String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  parentPickListId String?
  events           PickEvent[]
  items            PickListItem[]
  assignedUser     User?          @relation(fields: [assignedTo], references: [id])
  parentPickList   PickList?      @relation("PickListContinuation", fields: [parentPickListId], references: [id])
  continuations    PickList[]     @relation("PickListContinuation")

  @@map("pick_lists")
}

model PickListItem {
  id               String         @id @default(cuid())
  pickListId       String
  orderId          String
  productVariantId String
  locationId       String
  quantityToPick   Int
  quantityPicked   Int            @default(0)
  pickSequence     Int
  status           PickItemStatus @default(PENDING)
  pickedAt         DateTime?
  pickedBy         String?
  shortPickReason  String?
  notes            String?
  orderItemId      String?
  location         Location       @relation(fields: [locationId], references: [id])
  order            Order          @relation(fields: [orderId], references: [id])
  orderItem        OrderItem?     @relation(fields: [orderItemId], references: [id])
  pickList         PickList       @relation(fields: [pickListId], references: [id], onDelete: Cascade)
  picker           User?          @relation(fields: [pickedBy], references: [id])
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])

  @@unique([pickListId, orderId, productVariantId, locationId])
  @@map("pick_list_items")
}

model PickEvent {
  id          String        @id @default(cuid())
  pickListId  String
  itemId      String?
  eventType   PickEventType
  userId      String
  location    String?
  scannedCode String?
  data        Json?
  notes       String?
  createdAt   DateTime      @default(now())
  fromUserId  String?
  toUserId    String?
  fromUser    User?         @relation("PickEventFromUser", fields: [fromUserId], references: [id])
  pickList    PickList      @relation(fields: [pickListId], references: [id], onDelete: Cascade)
  toUser      User?         @relation("PickEventToUser", fields: [toUserId], references: [id])
  user        User          @relation("PickEventUser", fields: [userId], references: [id])

  @@map("pick_events")
}

model ShippingPackage {
  id             String        @id @default(cuid())
  orderId        String
  carrierCode    String
  serviceCode    String
  trackingNumber String
  labelUrl       String
  cost           Decimal       @db.Decimal(10, 2)
  currency       String
  weight         Decimal?      @db.Decimal(8, 2)
  dimensions     Json?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  packageCode    String?
  packageNumber  Int           @default(1)
  packingSlipUrl String?
  totalPackages  Int           @default(1)
  createdBy      String?
  shippedAt      DateTime?
  shippedBy      String?
  backOrders     BackOrder[]
  items          PackageItem[]
  createdByUser  User?         @relation("ShippingPackageCreatedBy", fields: [createdBy], references: [id])
  order          Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  shippedByUser  User?         @relation("ShippingPackageShippedBy", fields: [shippedBy], references: [id])

  @@map("shipping_packages")
}

model PackageItem {
  id          String          @id @default(cuid())
  packageId   String
  productName String
  sku         String
  quantity    Int
  unitPrice   Decimal         @db.Decimal(10, 2)
  createdAt   DateTime        @default(now())
  package     ShippingPackage @relation(fields: [packageId], references: [id], onDelete: Cascade)

  @@map("package_items")
}

model CycleCountCampaign {
  id                String           @id @default(cuid())
  name              String
  description       String?
  countType         CycleCountType
  status            CampaignStatus   @default(PLANNED)
  startDate         DateTime
  endDate           DateTime?
  frequency         CountFrequency?
  locationIds       String[]
  zoneFilter        String?
  abcClass          String?
  lastCountedBefore DateTime?
  totalTasks        Int              @default(0)
  completedTasks    Int              @default(0)
  variancesFound    Int              @default(0)
  createdBy         String
  assignedTo        String[]
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  tasks             CycleCountTask[]

  @@map("cycle_count_campaigns")
}

model CycleCountTask {
  id                  String               @id @default(cuid())
  campaignId          String?
  locationId          String
  productVariantId    String?
  taskNumber          String               @unique
  priority            Int                  @default(0)
  countType           CycleCountType
  systemQuantity      Int
  countedQuantity     Int?
  variance            Int?
  variancePercentage  Decimal?             @db.Decimal(5, 2)
  assignedTo          String?
  assignedAt          DateTime?
  startedAt           DateTime?
  completedAt         DateTime?
  notes               String?
  tolerancePercentage Decimal?             @default(5.0) @db.Decimal(5, 2)
  requiresRecount     Boolean              @default(false)
  recountReason       String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  status              CycleCountTaskStatus @default(PENDING)
  events              CycleCountEvent[]
  assignedUser        User?                @relation(fields: [assignedTo], references: [id])
  campaign            CycleCountCampaign?  @relation(fields: [campaignId], references: [id])
  location            Location             @relation(fields: [locationId], references: [id])
  productVariant      ProductVariant?      @relation(fields: [productVariantId], references: [id])

  @@unique([campaignId, locationId, productVariantId])
  @@map("cycle_count_tasks")
}

model CycleCountEvent {
  id            String         @id @default(cuid())
  taskId        String
  eventType     CountEventType
  userId        String
  previousValue Int?
  newValue      Int?
  notes         String?
  metadata      Json?
  createdAt     DateTime       @default(now())
  task          CycleCountTask @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user          User           @relation(fields: [userId], references: [id])

  @@map("cycle_count_events")
}

model PurchaseOrder {
  id           String              @id @default(cuid())
  poNumber     String              @unique
  supplier     String
  status       String              @default("DRAFT")
  orderDate    DateTime            @default(now())
  expectedDate DateTime?
  totalAmount  Decimal             @db.Decimal(10, 2)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  items        PurchaseOrderItem[]

  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id               String         @id @default(cuid())
  purchaseOrderId  String
  productVariantId String
  quantity         Int
  unitCost         Decimal        @db.Decimal(10, 2)
  totalCost        Decimal        @db.Decimal(10, 2)
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])
  purchaseOrder    PurchaseOrder  @relation(fields: [purchaseOrderId], references: [id])

  @@map("purchase_order_items")
}

model ForecastSuggestion {
  id             String    @id @default(cuid())
  sku            String    @unique
  productName    String?
  vendorId       String?
  warehouseId    String?
  currentStock   Int?
  forecast30Days Int?
  forecast60Days Int?
  forecast90Days Int?
  daysOfStock    Int?
  safetyStock    Int?
  leadTimeDays   Int?
  reorderPoint   DateTime?
  recommendedQty Int?
  unitCost       Float?
  currency       String?
  lastUpdated    DateTime
  replenishment  Int?
  reviewPeriod   Int?

  @@index([sku, warehouseId])
}

model InventoryPlannerPurchaseOrder {
  id           String                   @id @default(cuid())
  poId         String                   @unique
  reference    String?
  vendorId     String?
  vendorName   String?
  status       String
  createdAt    DateTime
  expectedDate DateTime?
  currency     String?
  totalValue   Float?
  lastUpdated  DateTime
  lines        InventoryPlannerPOLine[]
}

model InventoryPlannerPOLine {
  id              String                        @id @default(cuid())
  purchaseOrderId String
  sku             String
  productName     String?
  qtyOrdered      Int
  unitCost        Float?
  totalCost       Float?
  purchaseOrder   InventoryPlannerPurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@index([sku])
}

model SyncProgress {
  id          String   @id @default(cuid())
  type        String   @unique
  status      String
  progress    Int      @default(0)
  total       Int      @default(0)
  currentPage Int      @default(0)
  message     String
  userId      String?
  startedAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([type, status])
}

model SyncLog {
  id     String   @id @default(cuid())
  type   String
  status String
  count  Int?
  error  String?
  runAt  DateTime @default(now())
}

model BackOrder {
  id                     String           @id @default(cuid())
  orderId                String
  productVariantId       String
  quantityBackOrdered    Int
  quantityFulfilled      Int              @default(0)
  status                 BackOrderStatus  @default(PENDING)
  reason                 BackOrderReason
  reasonDetails          String?
  priority               Int              @default(0)
  originalPickListItemId String?
  fulfilledAt            DateTime?
  createdAt              DateTime         @default(now())
  updatedAt              DateTime         @updatedAt
  createdDuring          String
  shippingPackageId      String?
  createdBy              String?
  expectedRestockDate    DateTime?
  fulfilledBy            String?
  createdByUser          User?            @relation("BackOrderCreatedBy", fields: [createdBy], references: [id])
  fulfilledByUser        User?            @relation("BackOrderFulfilledBy", fields: [fulfilledBy], references: [id])
  order                  Order            @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productVariant         ProductVariant   @relation(fields: [productVariantId], references: [id])
  shippingPackage        ShippingPackage? @relation(fields: [shippingPackageId], references: [id])

  @@unique([orderId, productVariantId])
  @@index([status])
  @@index([productVariantId, status])
  @@index([shippingPackageId])
  @@map("back_orders")
}

model ReceivingSession {
  id              String           @id @default(cuid())
  poId            String
  poReference     String
  vendor          String?
  status          ReceivingStatus  @default(PENDING)
  countedBy       String
  countedAt       DateTime         @default(now())
  approvedBy      String?
  approvedAt      DateTime?
  rejectionReason String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  submittedAt     DateTime?
  assignedTo      String?
  events          ReceivingEvent[]
  lineItems       ReceivingLine[]
  approvedByUser  User?            @relation("ApprovedBy", fields: [approvedBy], references: [id])
  assignedToUser  User?            @relation("AssignedReceivingApprover", fields: [assignedTo], references: [id])
  countedByUser   User             @relation("CountedBy", fields: [countedBy], references: [id])

  @@index([poId])
  @@index([status])
  @@index([countedBy])
  @@index([assignedTo])
  @@map("receiving_sessions")
}

model ReceivingLine {
  id               String           @id @default(cuid())
  sessionId        String
  sku              String
  productName      String
  quantityCounted  Int
  quantityExpected Int?
  variance         Int?
  session          ReceivingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, sku], name: "sessionId_sku")
  @@map("receiving_lines")
}

model POBarcode {
  id                String           @id @default(cuid())
  poId              String           @unique
  poReference       String
  vendorName        String
  barcodeValue      String           @unique
  barcodeType       String           @default("CODE128")
  printedCount      Int              @default(0)
  lastPrintedAt     DateTime?
  lastPrintedBy     String?
  scannedCount      Int              @default(0)
  lastScannedAt     DateTime?
  lastScannedBy     String?
  expectedItems     Json?
  totalExpectedQty  Int?
  status            String           @default("ACTIVE")
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  events            POBarcodeEvent[]
  lastPrintedByUser User?            @relation("UserPrintedBarcodes", fields: [lastPrintedBy], references: [id])

  @@index([poId])
  @@index([barcodeValue])
  @@index([status])
  @@map("po_barcodes")
}

model POBarcodeEvent {
  id        String             @id @default(cuid())
  barcodeId String
  poId      String
  eventType POBarcodeEventType
  userId    String?
  quantity  Int?               @default(1)
  source    String?
  metadata  Json?
  createdAt DateTime           @default(now())
  barcode   POBarcode          @relation(fields: [barcodeId], references: [id], onDelete: Cascade)
  user      User?              @relation(fields: [userId], references: [id])

  @@index([poId])
  @@index([barcodeId])
  @@map("po_barcode_events")
}

model ReceivingEvent {
  id        String           @id @default(cuid())
  sessionId String
  sku       String
  productId String?
  userId    String
  quantity  Int              @default(1)
  scannedAt DateTime         @default(now())
  source    String?
  notes     String?
  session   ReceivingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user      User             @relation(fields: [userId], references: [id])

  @@index([sessionId])
  @@index([sku])
  @@map("receiving_events")
}

model Invoice {
  id                 String        @id @default(cuid())
  invoiceNumber      String        @unique
  date               DateTime      @default(now())
  dueDate            DateTime?
  subtotal           Decimal       @db.Decimal(10, 2)
  tax                Decimal       @default(0) @db.Decimal(10, 2)
  total              Decimal       @db.Decimal(10, 2)
  status             InvoiceStatus @default(DRAFT)
  orderId            String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  createdBy          String?
  originalInvoiceUrl String?
  vendorAddress      String?
  vendorEmail        String?
  vendorName         String
  vendorPhone        String?
  barcodeValue       String?
  fees               Decimal       @default(0) @db.Decimal(10, 2)
  shipping           Decimal       @default(0) @db.Decimal(10, 2)
  items              InvoiceItem[]
  order              Order?        @relation(fields: [orderId], references: [id])

  @@index([invoiceNumber])
  @@index([vendorName])
  @@index([status])
  @@index([orderId])
  @@index([barcodeValue])
  @@map("invoices")
}

model InvoiceItem {
  id               String          @id @default(cuid())
  invoiceId        String
  sku              String
  quantity         Int
  unitPrice        Decimal         @db.Decimal(10, 2)
  total            Decimal         @db.Decimal(10, 2)
  productVariantId String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  barcodeValue     String?
  name             String
  invoice          Invoice         @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  productVariant   ProductVariant? @relation(fields: [productVariantId], references: [id])

  @@index([invoiceId])
  @@index([sku])
  @@index([barcodeValue])
  @@map("invoice_items")
}

model ReturnOrder {
  id                   String             @id @default(cuid())
  rmaNumber            String             @unique
  orderId              String
  customerName         String
  customerEmail        String
  status               ReturnStatus       @default(PENDING)
  reason               ReturnReason
  reasonDetails        String?
  refundMethod         RefundMethod       @default(ORIGINAL_PAYMENT)
  refundAmount         Decimal?           @db.Decimal(10, 2)
  refundStatus         RefundStatus       @default(PENDING)
  restockingFee        Decimal?           @db.Decimal(10, 2)
  returnTrackingNumber String?
  returnCarrier        String?
  customerShippedAt    DateTime?
  receivedAt           DateTime?
  receivedBy           String?
  inspectedAt          DateTime?
  inspectedBy          String?
  approvalRequired     Boolean            @default(false)
  approvedBy           String?
  approvedAt           DateTime?
  rejectionReason      String?
  shopifyRefundId      String?
  shopifySyncStatus    String?            @default("PENDING")
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  labelCreatedAt       DateTime?
  packagesExpected     Int                @default(1)
  returnLabelUrl       String?
  returnShippingCost   Decimal?           @db.Decimal(10, 2)
  events               ReturnEvent[]
  inspectionItems      ReturnInspection[]
  items                ReturnItem[]
  approvedByUser       User?              @relation("ReturnApprovedBy", fields: [approvedBy], references: [id])
  inspectedByUser      User?              @relation("ReturnInspectedBy", fields: [inspectedBy], references: [id])
  order                Order              @relation(fields: [orderId], references: [id])
  receivedByUser       User?              @relation("ReturnReceivedBy", fields: [receivedBy], references: [id])

  @@index([orderId])
  @@index([status])
  @@index([customerEmail])
  @@index([rmaNumber])
  @@map("return_orders")
}

model ReturnItem {
  id                  String             @id @default(cuid())
  returnOrderId       String
  productVariantId    String
  quantityRequested   Int
  quantityReceived    Int                @default(0)
  quantityRestockable Int                @default(0)
  quantityDisposed    Int                @default(0)
  orderItemId         String?
  unitPrice           Decimal            @db.Decimal(10, 2)
  refundAmount        Decimal            @db.Decimal(10, 2)
  status              ReturnItemStatus   @default(PENDING)
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  inspections         ReturnInspection[]
  productVariant      ProductVariant     @relation(fields: [productVariantId], references: [id])
  returnOrder         ReturnOrder        @relation(fields: [returnOrderId], references: [id], onDelete: Cascade)

  @@index([returnOrderId])
  @@index([productVariantId])
  @@map("return_items")
}

model ReturnInspection {
  id                String            @id @default(cuid())
  returnOrderId     String
  returnItemId      String
  condition         ReturnCondition
  conditionNotes    String?
  disposition       ReturnDisposition
  dispositionNotes  String?
  restockLocationId String?
  inspectedBy       String
  inspectedAt       DateTime          @default(now())
  photoUrls         String[]
  inspector         User              @relation("ReturnInspector", fields: [inspectedBy], references: [id])
  location          Location?         @relation(fields: [restockLocationId], references: [id])
  returnItem        ReturnItem        @relation(fields: [returnItemId], references: [id], onDelete: Cascade)
  returnOrder       ReturnOrder       @relation(fields: [returnOrderId], references: [id], onDelete: Cascade)

  @@index([returnOrderId])
  @@index([returnItemId])
  @@map("return_inspections")
}

model ReturnEvent {
  id            String          @id @default(cuid())
  returnOrderId String
  eventType     ReturnEventType
  userId        String?
  data          Json?
  notes         String?
  createdAt     DateTime        @default(now())
  returnOrder   ReturnOrder     @relation(fields: [returnOrderId], references: [id], onDelete: Cascade)
  user          User?           @relation(fields: [userId], references: [id])

  @@index([returnOrderId])
  @@map("return_events")
}

enum WorkTaskType {
  PICKING
  PACKING
  SHIPPING
  QC
}

enum WorkTaskStatus {
  PENDING
  ASSIGNED
  IN_PROGRESS
  PAUSED
  PARTIALLY_COMPLETED
  COMPLETED
  CANCELLED
}

enum WorkTaskItemStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  SKIPPED
  ISSUE
}

enum WorkTaskEventType {
  TASK_CREATED
  TASK_ASSIGNED
  TASK_STARTED
  TASK_PAUSED
  TASK_RESUMED
  ITEM_COMPLETED
  ITEM_SKIPPED
  TASK_COMPLETED
  TASK_CANCELLED
  TASK_REASSIGNED
  TASK_SPLIT
  LABEL_GENERATED
  LABEL_PRINTED
  LABEL_VOIDED
  PACKAGE_WEIGHED
  PACKAGE_DIMENSIONS_RECORDED
  CARRIER_SELECTED
  SERVICE_LEVEL_SELECTED
  RATE_SHOPPED
  INSURANCE_ADDED
  SIGNATURE_REQUIRED
  TRACKING_NUMBER_ASSIGNED
  SHIPMENT_MANIFESTED
  PICKUP_SCHEDULED
  PACKAGE_SCANNED
  SHIPMENT_VOIDED
  CUSTOMS_FORM_CREATED
  HAZMAT_DECLARED
}

enum UserRole {
  ADMIN
  MANAGER
  STAFF
  READONLY
}

enum LocationType {
  RECEIVING
  STORAGE
  PICKING
  PACKING
  SHIPPING
  RETURNS
  GENERAL
}

enum OrderStage {
  PICKING
  PACKING
  SHIPPING
  COMPLETED
}

enum ReservationStatus {
  ACTIVE
  FULFILLED
  CANCELLED
}

enum OrderStatus {
  PENDING
  ALLOCATED
  PICKING
  PICKED
  PACKED
  SHIPPED
  DELIVERED
  CANCELLED
  RETURNED
  FULFILLED
  PARTIALLY_PICKED
  PARTIALLY_SHIPPED
  BACKORDER
  PACKING
}

enum TransactionType {
  ADJUSTMENT
  RECEIPT
  SALE
  TRANSFER
  COUNT
  ALLOCATION
  DEALLOCATION
  PO_RECEIVING
  ASN_RECEIVING
  TRANSFER_RECEIVING
  RETURNS
}

enum PickStatus {
  PENDING
  ASSIGNED
  IN_PROGRESS
  PAUSED
  COMPLETED
  CANCELLED
  PARTIALLY_COMPLETED
}

enum PickItemStatus {
  PENDING
  PICKED
  SHORT_PICK
  SKIPPED
  DAMAGED
}

enum PickEventType {
  PICK_STARTED
  PICK_PAUSED
  PICK_RESUMED
  ITEM_PICKED
  ITEM_SHORT_PICKED
  ITEM_SKIPPED
  LOCATION_SCANNED
  BARCODE_SCANNED
  PICK_COMPLETED
  PICK_CANCELLED
  ERROR_OCCURRED
  PICK_REASSIGNED
  PICK_SPLIT
  PARTIAL_COMPLETION
}

enum CycleCountType {
  FULL
  PARTIAL
  ABC_ANALYSIS
  FAST_MOVING
  SLOW_MOVING
  NEGATIVE_STOCK
  ZERO_STOCK
  HIGH_VALUE
  DAMAGED_LOCATION
}

enum CampaignStatus {
  PLANNED
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum CycleCountTaskStatus {
  PENDING
  ASSIGNED
  IN_PROGRESS
  COMPLETED
  VARIANCE_REVIEW
  RECOUNT_REQUIRED
  SKIPPED
  CANCELLED
}

enum CountEventType {
  TASK_CREATED
  TASK_ASSIGNED
  COUNT_STARTED
  COUNT_RECORDED
  COUNT_SKIPPED
  VARIANCE_NOTED
  RECOUNT_REQUESTED
  TASK_COMPLETED
  TASK_CANCELLED
  NOTE_ADDED
}

enum CountFrequency {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  ANNUALLY
  AD_HOC
}

enum BackOrderStatus {
  PENDING
  FULFILLED
  CANCELLED
  ALLOCATED
  PARTIAL
  PICKING
  PICKED
  PACKED
}

enum BackOrderReason {
  INSUFFICIENT_STOCK_AT_ALLOCATION
  SHORT_PICK
  ITEM_SKIPPED
  DAMAGED_PRODUCT
  LOCATION_EMPTY
  OTHER
}

enum ReceivingStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum POBarcodeEventType {
  LABEL_PRINTED
  LABEL_REPRINTED
  LABEL_VOIDED
  LABEL_SCANNED
  SESSION_STARTED
  SESSION_COMPLETED
}

enum InvoiceStatus {
  DRAFT
  PENDING
  PAID
  CANCELLED
}

enum ReturnStatus {
  PENDING
  APPROVED
  REJECTED
  IN_TRANSIT
  RECEIVED
  INSPECTING
  INSPECTION_COMPLETE
  RESTOCKING
  REFUND_PENDING
  REFUNDED
  PARTIALLY_REFUNDED
  CLOSED
  CANCELLED
}

enum ReturnReason {
  DEFECTIVE
  WRONG_ITEM
  NOT_AS_DESCRIBED
  NO_LONGER_NEEDED
  ORDERED_BY_MISTAKE
  BETTER_PRICE
  DAMAGED_SHIPPING
  EXPIRED
  OTHER
}

enum RefundMethod {
  ORIGINAL_PAYMENT
  STORE_CREDIT
  REPLACEMENT
  NO_REFUND
}

enum RefundStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  PARTIAL
  CANCELLED
}

enum ReturnItemStatus {
  PENDING
  RECEIVED
  INSPECTED
  RESTOCKED
  DISPOSED
  VENDOR_RETURN
  QUARANTINE
}

enum ReturnCondition {
  NEW_UNOPENED
  NEW_OPENED
  LIKE_NEW
  GOOD
  FAIR
  POOR
  DEFECTIVE
  DAMAGED
  EXPIRED
  MISSING_PARTS
}

enum ReturnDisposition {
  RESTOCK
  DISPOSE
  REPAIR
  VENDOR_RETURN
  DONATE
  QUARANTINE
  LIQUIDATE
}

enum ReturnEventType {
  RMA_CREATED
  RMA_APPROVED
  RMA_REJECTED
  PACKAGE_SHIPPED
  PACKAGE_RECEIVED
  INSPECTION_STARTED
  ITEM_INSPECTED
  INSPECTION_COMPLETED
  ITEM_RESTOCKED
  ITEM_DISPOSED
  REFUND_INITIATED
  REFUND_COMPLETED
  REFUND_FAILED
  SHOPIFY_SYNCED
  NOTE_ADDED
  STATUS_CHANGED
}
